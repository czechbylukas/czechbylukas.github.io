<!DOCTYPE html>
<html lang="cs">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-1BCW5XQ0X5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1BCW5XQ0X5');
</script>

<title>Test Vocabulary - H√°Czech</title>
<link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/language-selector.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>

<style>
    /* Minimal styles to support the test logic within your design */
    .test-area { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; text-align: center; }
    .word-large { font-size: 2.5rem; font-weight: bold; margin: 10px 0; color: #d32f2f; }
    .trans-hidden { font-size: 1.5rem; color: #666; margin-bottom: 20px; visibility: hidden; }
    .btn-test { padding: 10px 20px; cursor: pointer; background: #2c3e50; color: white; border: none; border-radius: 5px; margin: 5px; }
</style>
</head>
<body class="home">

<header>
    <h1 id="heading-welcome">Welcome in H√°Czech</h1>
    <div id="language-selector-container"></div>
</header>

<main>
    <p id="heading-mainPageText">Test your vocabulary learned from the database.</p>

    <h2 id="heading-topics">Vocabulary Practice</h2>

    <div class="test-area">
        <select id="level-select" style="padding: 5px; margin-bottom: 10px;">
            <option value="A1">Level A1</option>
            <option value="A2">Level A2</option>
        </select>

        <div id="czech-word" class="word-large">---</div>
        <div id="english-word" class="trans-hidden">---</div>

        <button class="btn-test" onclick="getRandomWord()">Next Word</button>
        <button class="btn-test" style="background:#7f8c8d" onclick="document.getElementById('english-word').style.visibility='visible'">Show Answer</button>
    </div>

    <nav>
        <a id="menu-home" href="index.html">üè† Main Page</a>
        <a id="menu-vocabulary" href="vocabulary/index.html">üìò Vocabulary</a>
        <a id="menu-practicing" href="exercise/index.html">‚ùì Practicing</a>
    </nav>
</main>

<div id="footer-placeholder"></div>

<script>
    let db = null;

    async function initDatabase() {
        try {
            const sqlPromise = initSqlJs({ locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/${file}` });
            const response = await fetch("czech_master.db");
            const buf = await response.arrayBuffer();
            const [SQL, data] = await Promise.all([sqlPromise, buf]);
            db = new SQL.Database(new Uint8Array(data));
            console.log("Database connected!");
        } catch (err) {
            console.error("DB Load Error:", err);
        }
    }

    function getRandomWord() {
        if (!db) return;
        const level = document.getElementById('level-select').value;
        
        // This query is now more flexible to handle column naming issues
        try {
            const res = db.exec(`SELECT * FROM words WHERE level LIKE '%${level}%' ORDER BY RANDOM() LIMIT 1`);
            
            if (res.length > 0) {
                const columns = res[0].columns;
                const values = res[0].values[0];
                
                // Find column indexes dynamically in case they aren't lowercase
                const lemmaIdx = columns.findIndex(c => c.toLowerCase() === 'lemma');
                const transIdx = columns.findIndex(c => c.toLowerCase() === 'trans_en');

                document.getElementById('czech-word').innerText = values[lemmaIdx];
                document.getElementById('english-word').innerText = values[transIdx];
                document.getElementById('english-word').style.visibility = 'hidden';
            } else {
                alert("No words found for this level.");
            }
        } catch (e) {
            alert("SQL Error: " + e.message + "\nCheck your table column names in DB Browser!");
        }
    }

    initDatabase();

    fetch("footer.html")
        .then(response => response.text())
        .then(data => { document.getElementById("footer-placeholder").innerHTML = data; });
</script>

<script src="js/translations.js"></script>
<script src="js/language-selector.js"></script>

</body>
</html>